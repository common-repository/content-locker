/*!
* Content Locker
*
* (c) Copyright mythemeshop.com
*
* @version 1.0.0
* @author  MyThemeShop
*/


(function ($) {

var cl=window.ContentLocker={},Settings=function(){function get(id,defaults){return defaults=defaults||!1,'all'===id?options:_.has(options,id)?options[id]:defaults}function all(){return get('all')}var api={get:get,all:all},options={},defaults={};return _.has(window,'__contentlocker')&&_.has(__contentlocker,'global')&&(options=$.extend({},!0,defaults,__contentlocker.global)),api};cl.settings=new Settings;var Localization={defaults:{signin:{long:'Sign in via {name}',short:'via {name}',facebook:'Facebook',twitter:'Twitter',google:'Google',linkedin:'LinkedIn',email:'Email'},confirm:{screen_title:'Please Confirm Your Email',screen_instruction:'We have sent a confirmation email to {email}. Please click on the confirmation link in the email to reveal the content.',screen_note1:'The content will be unlocked automatically within 10 seconds after confirmation.',screen_note2:'Note delivering the email may take several minutes.',screen_cancel:'(cancel)',screen_open:'Open my inbox on {service}'},onestep:{screen_title:'One Step To Complete',screen_instruction:'Please enter your email below to continue.',screen_button:'OK, complete'},misc:{data_processing:'Processing data, please wait...',enter_your_name:'enter your name',enter_your_email:'enter your email address',your_agree_with:'By clicking on the button(s), you agree with {links}',terms_of_use:'Terms of Use',privacy_policy:'Privacy Policy',close:'Close',or:'OR'},error:'error',errors:{empty_email:'Please enter your email address.',incorrect_email:'It seems you entered an incorrect email address. Please check it.',empty_name:'Please enter your name.',not_signed_in:'Sorry, but you have not signed in. Please try again.',not_granted:'Sorry, but you have not granted all the required permissions ({permissions}). Please try again.'},notices:{unable_create_control:'Unable to create ({0}). Please make sure that nothing blocks loading of social scripts in your browser. Some browser extentions (Avast, PrivDog, AdBlock etc.) can cause this issue. Turn them off and try again.',empty_youtube_channelid:'Please set your Youtube Channel ID.',empty_google_clientid:'Please set your Google Client ID.',empty_linkedin_clientid:'The LinkedIn Client ID or Client Secret is not set. You need to set these settings before using the button.',empty_twitter_username:'Please set your twitter username to follow.',invlid_facebook_app_id:'Invalid App ID or given URL is not allowed by the Application configuration: One or more of the given URLs is not allowed by the App\'s settings.  It must match the Website URL or Canvas URL, or the domain must be a subdomain of one of the App\'s domains.',no_spam:'Your email address is 100% safe from spam!',unexpected_error:'Unable to sign in. Unexpected error occurred: {0}',no_user_data:'Unable to get user data',missed_twitter_user:'Please specify the Twitter user name to follow.',missed_twitter_message:'Please specify the message to tweet.'}},init:function(){cl.__=cl.__.defaults,_.has(window,'__contentlocker')&&_.has(__contentlocker,'lang')&&(cl.__=$.extend(!0,{},cl.__,__contentlocker.lang))}};cl.__=Localization,cl.__.init(),String.prototype.includes||(String.prototype.includes=function(search,start){return'number'!=typeof start&&(start=0),!(start+search.length>this.length)&&this.indexOf(search,start)!==-1});var Helpers={extend:function(protoProps,staticProps){var child,parent=this;return child=protoProps&&_.has(protoProps,'constructor')?protoProps.constructor:function(){return parent.apply(this,arguments)},_.extend(child,parent,staticProps),child.prototype=_.create(parent.prototype,protoProps),child.prototype.constructor=child,child.__super__=parent.prototype,child},hash:function(str){if(!str||0===str.length)return 0;var i,chr,len,hash=5381;for(i=0,len=str.length;i<len;i++)chr=str.charCodeAt(i),hash=(hash<<5)-hash+chr,hash&=hash;return hash=hash.toString(16),hash=hash.replace('-','0')},guid:function(){var d=(new Date).getTime();window.performance&&"function"==typeof window.performance.now&&(d+=performance.now());var uuid='xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(c){var r=(d+16*Math.random())%16|0;return d=Math.floor(d/16),('x'==c?r:3&r|8).toString(16)});return uuid},can_blur:{cssfilters:function(){var el=document.createElement('div'),_browserPrefixes=' -webkit- -moz- -o- -ms- '.split(' ');return el.style.cssText=_browserPrefixes.join("filter:blur(2px); "),!!el.style.length&&(void 0===document.documentMode||document.documentMode>9)}(),svgfilters:function(){var result=!1;try{result=void 0!==typeof SVGFEColorMatrixElement&&2===SVGFEColorMatrixElement.SVG_FECOLORMATRIX_TYPE_SATURATE}catch(e){}return result}()},support_blurring:function(){return this.can_blur.cssfilters||this.can_blur.svgfilters},is_valid_email:function(val){var reg=new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i);return reg.test(val)},store:{set:function(key,value,options){return this.is_localstorage()?this.local(key,value,options):this.cookie(key,value,options)},get:function(key){return this.is_localstorage()?this.local(key):this.cookie(key)},remove:function(key){return!!key&&(localStorage.removeItem(key),this.cookie(key,'',{expires:-1}),!0)},local:function(key,value,options){if(!key)return!1;if(arguments.length>1)return value={value:value,expires:this.expiry(options.expires)},localStorage.setItem(key,JSON.stringify(value)),!0;var item=localStorage.getItem(key);return!!item&&(item=JSON.parse(item),item.expires&&Date.now()>item.expires?(localStorage.removeItem(key),!1):item.value)},cookie:function(key,value,options){if(!key)return!1;if(arguments.length>1){options=$.extend({},{path:'/',expires:'30d'},options),options.expires=this.expiry(options.expires);var date=new Date;return date.setTime(options.expires),'object'==typeof value&&(value=JSON.stringify(value)),document.cookie=[encodeURIComponent(key)+'='+encodeURIComponent(value),options.expires?'; expires='+date.toUTCString():'',options.path?'; path='+options.path:'',options.domain?'; domain='+options.domain:'',options.secure?'; secure':''].join('')}for(var cookies=document.cookie?document.cookie.split('; '):[],rdecode=/(%[0-9A-Z]{2})+/g,i=0,result=!1;i<cookies.length;i++){var parts=cookies[i].split('='),name=parts[0].replace(rdecode,decodeURIComponent),cookie=parts.slice(1).join('=');if(key===name){'"'===cookie.charAt(0)&&(cookie=cookie.slice(1,-1));try{cookie=cookie.replace(rdecode,decodeURIComponent);try{cookie=JSON.parse(cookie)}catch(e){}}catch(e){}result=cookie;break}}return result},is_localstorage:function(){return'undefined'!=typeof Storage},expiry:function(val){if(!val)return!1;if(-1===val){var d=new Date;return d.setYear(1970),d.getTime()}var interval=parseInt(val),unit=val.replace(interval,'');return'd'===unit&&(interval=24*interval*60*60*1e3),'h'===unit&&(interval=60*interval*60*1e3),'m'===unit&&(interval=60*interval*1e3),'s'===unit&&(interval*=1e3),Date.now()+interval}}};cl.helpers=Helpers;var EventManager=function(){function add_action(action,callback,priority,context){return'string'==typeof action&&'function'==typeof callback&&(priority=parseInt(priority||10,10),_add_hook('actions',action,callback,priority,context)),api}function do_action(){var args=slice.call(arguments),action=args.shift();return'string'==typeof action&&_run_hook('actions',action,args),api}function remove_action(action,callback){return'string'==typeof action&&_remove_hook('actions',action,callback),api}function add_filter(filter,callback,priority,context){return'string'==typeof action&&'function'==typeof callback&&(priority=parseInt(priority||10,10),_add_hook('filters',filter,callback,priority,context)),api}function apply_filters(){var args=slice.call(arguments),filter=args.shift();return'string'==typeof filter?_run_hook('filters',filter,args):api}function remove_filter(filter,callback){return'string'==typeof filter&&_remove_hook('filters',filter,callback),api}function _add_hook(type,hook,callback,priority,context){var hookObject={callback:callback,priority:priority,context:context},hooks=STORAGE[type][hook];hooks?(hooks.push(hookObject),hooks=_hook_sort(hooks)):hooks=[hookObject],STORAGE[type][hook]=hooks}function _remove_hook(type,hook,callback,context){var handlers,handler,i;if(STORAGE[type][hook])if(callback)if(handlers=STORAGE[type][hook],context)for(i=handlers.length;i--;)handler=handlers[i],handler.callback===callback&&handler.context===context&&handlers.splice(i,1);else for(i=handlers.length;i--;)handlers[i].callback===callback&&handlers.splice(i,1);else STORAGE[type][hook]=[]}function _hook_sort(hooks){for(var tmpHook,j,prevHook,i=1,len=hooks.length;i<len;i++){for(tmpHook=hooks[i],j=i;(prevHook=hooks[j-1])&&prevHook.priority>tmpHook.priority;)hooks[j]=hooks[j-1],--j;hooks[j]=tmpHook}return hooks}function _run_hook(type,hook,args){var i,len,handlers=STORAGE[type][hook];if(!handlers)return'filters'===type&&args[0];if(len=handlers.length,'filters'===type)for(i=0;i<len;i++)args[0]=handlers[i].callback.apply(handlers[i].context,args);else for(i=0;i<len;i++)handlers[i].callback.apply(handlers[i].context,args);return'filters'!==type||args[0]}var slice=Array.prototype.slice,STORAGE={actions:{},filters:{}},api={add_filter:add_filter,apply_filters:apply_filters,remove_filter:remove_filter,add_action:add_action,do_action:do_action,remove_action:remove_action};return api};cl.hooks=new EventManager,cl.sdk={_connected:[],is_loaded:function(sdk){return sdk.is_loaded&&sdk.is_loaded()},connect:function(name){var sdk=_.has(cl.sdk,name)?cl.sdk[name]:null,def=$.Deferred();return sdk?sdk.loaded&&sdk.is_loaded()?(def.resolve(),def.promise()):($(document).bind(name+'-init',function(){def.resolve()}),$(document).bind(name+'-error',function(){def.reject('error-load')}),this._connected[name]||(sdk.init&&sdk.init(),this.loader(sdk),this._connected[name]=!0),def.promise()):(console.log('Invalide SDK: '+name),def.reject('invalid-sdk'),def.promise())},loader:function(sdk){var js,fjs=document.getElementsByTagName('script')[0];if(!document.getElementById(sdk.id)){if(js=document.createElement('script'),js.id=sdk.id,js.src=sdk.url,js.async=!0,sdk.events&&sdk.events(),!sdk.url)return void(sdk.loaded=!0);js.onload=js.onreadystatechange=function(){/^($|loaded|complete)/.test(js.readyState||'')&&(js.onload=js.onreadystatechange=null,sdk.loaded=!0,$(document).trigger(sdk.name+'-script-loaded'))},js.onerror=function(){js.onerror=null,sdk.loaded=!1,$(document).trigger(sdk.name+'-error')},fjs.parentNode.insertBefore(js,fjs)}}},cl.sdk.facebook={name:'facebook',id:'facebook-jssdk',url:'',setup:!1,is_loaded:function(){return'object'==typeof window.FB},init:function(){0===$('#fb-root').length&&$('body').append('<div id="fb-root"></div>'),this.url='//connect.facebook.net/'+cl.settings.get('lang')+'/sdk.js'},prepare:function(){if(!this.is_loaded()||!this.setup){var settings=cl.settings.get('facebook');window.FB.init({appId:settings&&settings.appid||null,status:!0,cookie:!0,version:settings.version}),window.FB.Event.subscribe('edge.create',function(url,el){$(document).trigger('mts-cl-facebook-like',[url,el])}),$(document).trigger('facebook-init'),this.setup=!0}},events:function(){var self=this;if(self.is_loaded())self.prepare();else{if(window.fbAsyncInit)var original=window.fbAsyncInit;window.fbAsyncInit=function(){self.prepare(),original&&original()}}}},cl.sdk.twitter={name:'twitter',id:'twitter-wjs',url:'//platform.twitter.com/widgets.js',setup:!1,is_loaded:function(){return'undefined'!=typeof window.__twttr},prepare:function(){this.is_loaded()&&this.setup||(window.twttr.events.bind('tweet',function(event){event&&$(document).trigger('mts-cl-twitter-tweet',[event])}),window.twttr.events.bind('follow',function(event){event&&$(document).trigger('mts-cl-twitter-follow',[event])}),$(document).trigger('twitter-init'),this.setup=!0)},events:function(){var self=this;self.is_loaded()?self.prepare():('object'!=typeof window.twttr&&(window.twttr=window.twttr||{},$.extend(window.twttr,{_e:[],ready:function(f){this._e.push(f)}})),window.twttr.ready(function(){self.prepare()}))}},cl.sdk.google={name:'google',id:'google-jssdk',url:'//apis.google.com/js/client:platform.js?onload=mts_cl_google_client_callback',setup:!1,is_loaded:function(){return window.gapi&&'object'==typeof window.gapi},prepare:function(){if(!this.is_loaded()||!this.setup){window.google_plusone_callback=function(data){'on'===data.state&&$(document).trigger('mts-cl-google-plus',[data])},window.google_plusone_start_interaction=function(data){cl.sdk.google.__google_share_url=data.id};var self=this;self.not_authed=!1,cl.settings.get('is_mobile')||cl.settings.get('is_tablet')||!window.addEventListener||window.addEventListener('message',function(obj){if(obj&&obj.data&&'string'==typeof obj.data&&-1===obj.data.indexOf('oauth2relay')){if(-1!==obj.data.indexOf('::drefresh'))return void(self.not_authed=!0);if(-1!==obj.data.indexOf('::_g_wasClosed')||-1!==obj.data.indexOf('::_g_closeMe')){if(self.not_authed)return void(self.not_authed=!1);$(document).trigger('mts-cl-google-share',[cl.sdk.google.__google_share_url])}}},!1),$(document).trigger('google-init'),this.setup=!0}},events:function(){var self=this;window.gapi||(window.___gcfg={lang:cl.settings.get('lang')}),window.mts_cl_google_client_callback=function(){self.prepare()}}},cl.sdk.linkedin={name:'linkedin',id:'linkedin-jssdk',url:'//platform.linkedin.com/in.js',setup:!1,is_loaded:function(){return window.IN&&'object'==typeof window.IN},prepare:function(){this.is_loaded()&&this.setup||(window.IN.init(),$(document).trigger('linkedin-init'),this.setup=!0)},events:function(){var self=this,original=window.open;self.is_loaded()?self.prepare():$(document).bind('linkedin-script-loaded',function(){self.prepare()}),window.open=function(url,name,specs,replace){var popup=original(url,name,specs,replace);if(!popup)return popup;var new_name=name||popup.name;return new_name.includes('easyXDM_IN')&&(cl.sdk.linkedin._active_popup=popup),popup}}},cl.sdk['linkedin-connect']={name:'linkedin-connect',id:'linkedin-connect-jssdk',url:'//platform.linkedin.com/in.js?async=true',setup:!1,is_loaded:function(){return window.IN&&'object'==typeof window.IN},prepare:function(){this.is_loaded()&&this.setup||(window.IN.init({api_key:cl.settings.get('linkedin').client_id}),$(document).trigger('linkedin-connect-init'),this.setup=!0)},events:function(){var self=this;self.is_loaded()?self.prepare():$(document).bind('linkedin-connect-script-loaded',function(){self.prepare()})}},cl.sdk.email={name:'email',setup:!1,is_loaded:function(){return!0},prepare:function(){this.is_loaded()&&this.setup||($(document).trigger('email-init'),this.setup=!0)},events:function(){var self=this;self.is_loaded()&&self.prepare()}},cl.controls={};var ControlBase=function(options,locker){if(this.errors=[],this.is_loading=!1,this.el=null,this.container=null,this.locker=locker,this.options=$.extend(!0,{},this.defaults,options),this.verification=$.extend(!0,{},{container:'iframe',timeout:5e3},this.verification),!this.name)throw new Error('The property "name" cannot be empty for the control.');this.init.apply(this,arguments)};ControlBase.extend=cl.helpers.extend,_.extend(ControlBase.prototype,{init:function(){},render:function(container){if(this.container=container,this.el=container.find('.mts-cl-control-placeholder'),this.has_error())return this.show_error(),this;var obj,self=this;return self.set_loading_state(),obj=cl.sdk.connect(self.sdk),obj.fail(function(result){self.remove_loading_state(),self.show_log(result)}),obj.done(function(){self.create_events(),self._render();var def=self.verify_button();def.always(function(){self.remove_loading_state()}),def.fail(function(result){self.show_log(result)})}),this},get_identity:function(){return this._identity?this._identity:(this._identity='page_'+cl.helpers.hash(this.options.url)+'_hash_'+this.name,this._identity)},create_events:function(){},unlock:function(type,name,control){var self=this;self.locker.unlock(type||'button',name||self.name,control||self)},verify_button:function(){var self=this,def=$.Deferred(),timer=self.verification.timeout,verify=function(){if(0===self.container.find(self.verification.container).length&&timer>=0)return setTimeout(function(){verify()},500),void(timer-=500);if(0>=timer){var notice=cl.__.notices.unable_create_control.replace('{0}',self.sdk);return void def.reject(notice)}def.resolve()};return verify(),def.promise()},set_loading_state:function(){this.is_loading=!0,this.container.addClass('mts-cl-state-loading')},remove_loading_state:function(){this.is_loading=!1,this.container.removeClass('mts-cl-state-loading')},show_log:function(result){console.log(result)},show_notice:function(msg){var self=this,notice=$('<div class="mts-cl-group-notice">'+msg+'</div>'),group=self.container.parent();notice.hide(),group.find('.mts-cl-group-error').remove(),group.append(notice),notice.fadeIn(500),setTimeout(function(){notice.fadeOut(500,function(){notice.remove()})},5e3)},show_error:function(){var self=this;if(!self.container.hasClass('mts-cl-state-error')){var notice=$('<div class="mts-cl-error-body"><a href="#" class="mts-cl-error-title">'+cl.__.error+'</a></div>');notice.click(function(){return self.show_notice(self.errors.join('<br>')),!1}),self.container.removeClass('mts-cl-state-loading').addClass('mts-cl-state-error'),self.el.replaceWith(notice)}},set_error:function(msg){this.errors.push(msg)},has_error:function(){return!!this.errors.length}}),cl.controls.base=ControlBase;var FacebookLike=ControlBase.extend({sdk:'facebook',name:'facebook-like',defaults:{url:null,button_title:null,layout:'button_count',width:null,action:'like',colorscheme:'light',ref:null},init:function(){this.locker.is_vertical()&&(this.options.layout='box_count'),this.locker.has_counters()||(this.options.layout='button')},create_events:function(){var self=this;$(document).on('mts-cl-facebook-like',function(){self.locker.unlock('button',self.name,self)})},_render:function(){var self=this,attributes={class:'fb-like','data-show-faces':!1,'data-share':!1,'data-href':self.options.url,'data-colorscheme':self.options.colorscheme,'data-layout':self.options.layout,'data-action':self.options.action};self.options.ref&&(attributes['data-ref']=self.options.ref),self.options.width&&(attributes['data-width']=self.options.width);var button=$('<div class="mts-cl-control-button"><div class="mts-cl-control-button-wrapper"><div class="mts-cl-icon"><i class="fa fa-facebook"></i></div><div class="mts-cl-control-title-wrapper">'+self.options.button_title+'</div><div class="mts-cl-social-control-wrapper"></div></div></div>'),control=$('<div></div>',attributes);return button.find('.mts-cl-social-control-wrapper').append(control),self.el.replaceWith(button),FB.XFBML.parse(self.container[0]),this}});cl.controls['facebook-like']=FacebookLike;var TwitterTweet=ControlBase.extend({sdk:'twitter',name:'twitter-tweet',defaults:{url:null,text:null,via:null,button_title:null,size:'medium',lang:cl.settings.get('short_lang')},create_events:function(){var self=this;$(document).on('mts-cl-twitter-tweet',function(){self.locker.unlock('button',self.name,self)})},_render:function(){var self=this,attributes={class:'twitter-share-button',href:'https://twitter.com/share',text:'Tweet','data-url':self.options.url,'data-lang':self.options.lang,'data-size':self.options.size};self.options.text&&(attributes['data-text']=self.options.text),self.options.via&&(attributes['data-via']=self.options.via);var button=$('<div class="mts-cl-control-button"><div class="mts-cl-control-button-wrapper"><div class="mts-cl-icon"><i class="fa fa-twitter"></i></div><div class="mts-cl-control-title-wrapper">'+self.options.button_title+'</div><div class="mts-cl-social-control-wrapper"></div></div></div>'),control=$('<a></a>',attributes);return button.find('.mts-cl-social-control-wrapper').append(control),self.el.replaceWith(button),twttr.widgets.load(self.container[0]),this}});cl.controls['twitter-tweet']=TwitterTweet;var GooglePlus=ControlBase.extend({sdk:'google',name:'google-plus',defaults:{url:null,size:'medium',annotation:'bubble',width:null,align:'left',recommendations:!0},init:function(){this.locker.is_vertical()&&(this.options.size='tall'),this.locker.has_counters()||(this.options.annotation='none')},create_events:function(){var self=this;$(document).on('mts-cl-google-plus',function(){self.locker.unlock('button',self.name,self)})},_render:function(){var self=this,attributes={class:'g-plusone','data-href':self.options.url,'data-size':self.options.size,'data-annotation':self.options.annotation,'data-align':self.options.align,'data-recommendations':self.options.recommendations,'data-callback':'google_plusone_callback'};self.options.width&&(attributes['data-width']=self.options.width);var button=$('<div class="mts-cl-control-button"><div class="mts-cl-control-button-wrapper"><div class="mts-cl-icon"><i class="fa fa-google-plus"></i></div><div class="mts-cl-control-title-wrapper">'+self.options.button_title+'</div><div class="mts-cl-social-control-wrapper"></div></div></div>'),control=$('<div></div>',attributes);return button.find('.mts-cl-social-control-wrapper').append(control),self.el.replaceWith(button),window.gapi.plusone.go(self.container[0]),this}});cl.controls['google-plus']=GooglePlus;var ControlSigninBase=ControlBase.extend({render:function(container){if(this.container=container,this.el=container.find('.mts-cl-control-placeholder'),this.has_error())return this.show_error(),this;var obj,self=this;return self.set_loading_state(),obj=cl.sdk.connect(self.sdk),obj.fail(function(result){self.remove_loading_state(),self.show_log(result)}),obj.done(function(){self.create_events(),self._render(),self.handle_click()}),this},process_button_title:function(type,name){return cl.__.signin[type].replace('{name}',name)},handle_click:function(){var self=this;self.el.click(function(){return self.connect(function(data,service_data){self.run_actions(data,service_data,!0)}),!1})},get_identity:function(){return this._identity?this._identity:(this._identity='mts_content_locker_'+cl.helpers.hash(this.name)+'_hash_'+this.name,this._identity)},connect:function(){throw new Error("The control should implement the method 'connect'")},run_actions:function(data,service_data,loader){var self=this,def=$.Deferred();if(!self._actions_done){self._actions_done=!0;var actions=self.options.actions.slice();loader&&self.locker.screen('loader');var run=function(){var action=actions.shift();if(!action)return def.resolve(),void self.unlock();var func='run_'+action+'_action';if(!self[func])throw def.reject(),self._actions_done=!1,new Error("The action ''"+func+"' not found.'");self[func](data,service_data,action,loader,function(status){return'error'===status?(self.locker.do_action('raw-error'),def.reject(status),self._actions_done=!1,void self.locker.screen('default')):void run()})};return run(),def.promise()}},run_signup_action:function(lead,service_data,action,loader,callback){var self=this,run=function(){loader&&self.locker.screen('loader');var data={};data.identity=lead,data.handler='signup',data.context=self.locker.get_context_data(),data=cl.hooks.apply_filters(self.locker.id+'.ajax-data',data),data=cl.hooks.apply_filters(self.locker.id+'.lead.ajax-data',data),data.action='mts_cl_connect',data.security=__contentlocker.security,$.ajax({url:__contentlocker.ajaxurl,type:'POST',dataType:'json',data:data,success:function(response){response&&response.success&&callback(),response&&!response.success&&(self.show_notice(response.error),callback('error'))},error:function(response){response&&response.readyState<4&&(self.locker.screen('default'),self.show_notice('Unable to sign in, the ajax error occured.'),callback('error'),console.log('Invalide ajax response: '+response.responseText))}})};return lead.email?void run():void self.locker.screen('enter-email',{title:cl.__.onestep.screen_title,message:cl.__.onestep.screen_instruction,button_title:cl.__.onestep.screen_button,note:cl.__.notices.no_spam,callback:function(email){lead.email=email,run()}})},run_lead_action:function(lead,service_data,action,loader,callback){var self=this,run=function(){loader&&self.locker.screen('loader');var data={};lead.list_id=self.options.list_id,data.identity=lead,data.handler='lead',data.context=self.locker.get_context_data(),data=cl.hooks.apply_filters(self.locker.id+'.ajax-data',data),data=cl.hooks.apply_filters(self.locker.id+'.lead.ajax-data',data),data.action='mts_cl_connect',data.security=__contentlocker.security,$.ajax({url:__contentlocker.ajaxurl,type:'POST',dataType:'json',data:data,success:function(response){response&&response.success&&callback(),response&&!response.success&&(self.show_notice(response.error),callback('error'))},error:function(response){response&&response.readyState<4&&(self.locker.screen('default'),self.show_notice('Unable to sign in, the ajax error occured.'),callback('error'),console.log('Invalide ajax response: '+response.responseText))}})};return lead.email?void run():void self.locker.screen('enter-email',{title:cl.__.onestep.screen_title,message:cl.__.onestep.screen_instruction,button_title:cl.__.onestep.screen_button,note:cl.__.notices.no_spam,callback:function(email){lead.email=email,run()}})},_track_window:function(search,callback){var original=window.open;window.open=function(url,name,specs,replace){var popup=original(url,name,specs,replace);if(!popup)return popup;if(!url.includes(search))return popup;var interval=setInterval(function(){popup&&popup.closed&&(clearInterval(interval),callback&&callback())},300);return popup}}});cl.controls.base_signin=ControlSigninBase;var FacebookSignin=ControlSigninBase.extend({sdk:'facebook',name:'facebook',defaults:{},init:function(){this.permissions=this.rest_permissions=['public_profile','email']},_render:function(){var self=this,long_title='<span class="mts-cl-long-title">'+self.process_button_title('long',cl.__.signin.facebook)+'</span>',short_title='<span class="mts-cl-short-title">'+self.process_button_title('short',cl.__.signin.facebook)+'</span>',button=$('<a href="#" class="mts-cl-control-button mts-cl-connect-button mts-cl-connect-facebook"><div class="mts-cl-icon"><i class="fa fa-facebook"></i></div><div class="mts-cl-control-title-wrapper">'+long_title+short_title+'</div></div></a>');self.el.replaceWith(button),self.el=button;var loggedin=!1;FB.getLoginStatus(function(response){self.check_permissions(response,function(){loggedin=!0,self.remove_loading_state()})}),setTimeout(function(){loggedin||(self.set_error(cl.__.notices.invlid_facebook_app_id),self.show_error())},2e3)},connect:function(callback){var self=this;if('connected'===self._status&&!self.rest_permissions.length)return void self._identify(function(data){callback(data,self._service_data)});var result=!1;self._track_window('facebook.com/dialog/oauth',function(){setTimeout(function(){result||(self.locker.do_action('raw-social-app-declined'),self.show_notice(cl.__.errors.not_signed_in))},500)}),FB.login(function(response){result=!0,self.check_permissions(response,function(){'connected'!==self._status?(self.locker.do_action('raw-social-app-declined'),self.show_notice(cl.__.errors.not_signed_in)):self.rest_permissions.length?(self.locker.do_action('raw-social-app-declined'),self.show_notice(cl.__.errors.not_granted.replace('{permissions}',self.rest_permissions.join(', ')))):self._identify(function(data){callback(data,self._service_data)})})},{scope:self.rest_permissions.join(',')})},check_permissions:function(response,callback){var self=this;self._status=response.status,self._service_data=response,response&&'connected'===self._status?FB.api('/me/permissions',function(response){if(response&&response.data){var rest=[];$.each(response.data,function(){'granted'!==this.status&&rest.push(this.permission)}),self.rest_permissions=rest,callback&&callback()}}):callback&&callback()},_identify:function(callback){FB.api('/me?fields=email,first_name,last_name,gender,link',function(response){var data={};response&&(data.source='facebook',data.social=!0,data.email=response.email,data.display_name=response.first_name+' '+response.last_name,data.name=response.first_name,data.family=response.last_name,data.gender=response.gender,data.facebook_url=response.link,data.image='https://graph.facebook.com/'+response.id+'/picture?type=large'),callback(data)})}});cl.controls.facebook=FacebookSignin;var GoogleSignin=ControlSigninBase.extend({sdk:'google',name:'google',defaults:{},init:function(){return cl.settings.get('google').client_id||this.set_error(cl.__.notices.empty_google_clientid),this.permissions=['https://www.googleapis.com/auth/userinfo.profile','https://www.googleapis.com/auth/userinfo.email'],-1!==$.inArray('youtube_subscribe',this.options.actions)&&this.permissions.push('https://www.googleapis.com/auth/youtube'),this.has_error()?this:void(this.rest_permissions=this.permissions)},_render:function(){var self=this,long_title='<span class="mts-cl-long-title">'+self.process_button_title('long',cl.__.signin.google)+'</span>',short_title='<span class="mts-cl-short-title">'+self.process_button_title('short',cl.__.signin.google)+'</span>',button=$('<a href="#" class="mts-cl-control-button mts-cl-connect-button mts-cl-connect-google"><div class="mts-cl-control-button-wrapper"><div class="mts-cl-icon"><i class="fa fa-google-plus"></i></div><div class="mts-cl-control-title-wrapper">'+long_title+short_title+'</div></div></a>');self.el.replaceWith(button),self.el=button,self.remove_loading_state()},connect:function(callback){var self=this,result=!1,options={callback:function(response){'immediate_failed'!==response.error&&(result=!0,response&&response.status.signed_in?self._identify(function(status,data){return'error'===status?void self.show_notice(cl.__.notices.unexpected_error.replace('{0}',data)):void callback(data,response)}):(self.locker.do_action('raw-social-app-declined'),self.show_notice(cl.__.errors.not_signed_in)))}};options.clientid=cl.settings.get('google').client_id,options.cookiepolicy='single_host_origin',options.scope=this.permissions.join(' '),self._track_window('google.com/o/oauth2',function(){setTimeout(function(){result||(self.locker.do_action('raw-social-app-declined'),self.show_notice(cl.__.errors.not_signed_in))},500)}),gapi.auth.signIn(options)},_identify:function(callback){gapi.client.load('plus','v1').then(function(){gapi.client.plus.people.get({userId:'me'}).then(function(response){var data={};response&&response.result?(response=response.result,data.source='google',data.social=!0,data.email=response.emails&&response.emails[0]&&response.emails[0].value,data.display_name=response.displayName,data.name=response.name&&response.name.givenName,data.family=response.name&&response.name.familyName,data.gender=response.gender,data.google_url=response.url,data.image=function(){return response.image&&response.image.url?response.image.url.replace(/\?sz=\d+/gi,''):''}(),callback('success',data)):callback('error',{})},function(response){callback('error',response.result.error.message)})})},run_youtube_subscribe_action:function(lead,service_data,action,loader,callback){var self=this;gapi.client.load('youtube','v3',function(){var request=gapi.client.youtube.subscriptions.insert({
part:'snippet',resource:{snippet:{resourceId:{kind:"youtube#channel",channelId:self.options.youtube.channel_id}}}});request.execute(function(response){response&&response.error?response.error.data&&response.error.data[0]&&'subscriptionDuplicate'===response.error.data[0].reason?callback():(callback('error'),self.show_notice(response.error.message),console.log(response)):(self.locker.do_action('got-youtube-subscriber',[response]),callback())})})}});cl.controls.google=GoogleSignin;var LinkedinSignin=ControlSigninBase.extend({sdk:'linkedin-connect',name:'linkedin',defaults:{},init:function(){cl.settings.get('linkedin').client_id||this.set_error(cl.__.notices.empty_linkedin_clientid)},_render:function(){var self=this,long_title='<span class="mts-cl-long-title">'+self.process_button_title('long',cl.__.signin.linkedin)+'</span>',short_title='<span class="mts-cl-short-title">'+self.process_button_title('short',cl.__.signin.linkedin)+'</span>',button=$('<a href="#" class="mts-cl-control-button mts-cl-connect-button mts-cl-connect-linkedin"><div class="mts-cl-control-button-wrapper"><div class="mts-cl-icon"><i class="fa fa-linkedin"></i></div><div class="mts-cl-control-title-wrapper">'+long_title+short_title+'</div></div></a>');self.el.replaceWith(button),self.el=button,self.remove_loading_state()},connect:function(callback){var self=this,result=!1;self._track_window('platform.linkedin.com',function(){setTimeout(function(){result||(self.locker.do_action('raw-social-app-declined'),self.show_notice(cl.__.errors.not_signed_in))},500)}),IN.User.authorize(function(response){result=!0,self._identify(function(status,data){return'error'===status?void self.show_notice(cl.__.notices.no_user_data+': '+data):void callback(data,response)})})},_identify:function(callback){var fields=['firstName','lastName','emailAddress','publicProfileUrl','pictureUrls::(original)'];IN.API.Profile('me').fields(fields.join(',')).result(function(response){var data={},me=response.values[0];data.source='linkedin',data.social=!0,data.email=me.emailAddress,data.display_name=me.firstName+' '+me.lastName,data.name=me.firstName,data.family=me.lastName,data.linkedin_url=me.publicProfileUrl,data.image=function(){return me.pictureUrls&&me.pictureUrls.values?me.pictureUrls.values[0]:''}(),callback('success',data)}).error(function(response){callback('error',response)})}});cl.controls.linkedin=LinkedinSignin;var TwitterSignin=ControlSigninBase.extend({sdk:'twitter',name:'twitter',defaults:{},_render:function(){var self=this,long_title='<span class="mts-cl-long-title">'+self.process_button_title('long',cl.__.signin.twitter)+'</span>',short_title='<span class="mts-cl-short-title">'+self.process_button_title('short',cl.__.signin.twitter)+'</span>',button=$('<a href="#" class="mts-cl-control-button mts-cl-connect-button mts-cl-connect-twitter"><div class="mts-cl-control-button-wrapper"><div class="mts-cl-icon"><i class="fa fa-twitter"></i></div><div class="mts-cl-control-title-wrapper">'+long_title+short_title+'</div></div></a>');self.el.replaceWith(button),self.el=button,self.remove_loading_state()},connect:function(callback){var self=this;if(cl.twitterOAuthReady)self._identify(function(data){callback(data,{visitor_id:self._visitor_id})});else{var options={handler:'twitter',request:'init',options:JSON.stringify(self.options),action:'mts_cl_connect',security:__contentlocker.security},twid=cl.helpers.store.cookie('mts_cl_twid');twid&&'null'!==twid&&(options.visitor_id=twid);var url=__contentlocker.ajaxurl+'?'+$.param(options);self._track_window('handler=twitter',function(){setTimeout(function(){cl.twitterOAuthReady||(self.locker.do_action('raw-social-app-declined'),self.show_notice(cl.__.errors.not_signed_in))},500)}),window.open(url,'Twitter Sign-In','width=500,height=450,resizable=yes,scrollbars=yes,status=yes'),window.mts_cl_twitter_oauth_completed=function(res){cl.twitterOAuthReady=!0,self._set_visitor_id(res),self.connect(callback)},window.mts_cl_twitter_oauth_denied=function(res){self.locker.do_action('raw-social-app-declined'),self.show_notice(cl.__.errors.not_signed_in),self._set_visitor_id(res)}}},_set_visitor_id:function(id){this._visitor_id=id,cl.helpers.store.cookie('mts_cl_twid',id,{expires:'2s'})},_identify:function(callback){var self=this,request=$.ajax({url:__contentlocker.ajaxurl,type:'POST',dataType:'json',data:{handler:'twitter',request:'user_info',visitor_id:self._visitor_id,action:'mts_cl_connect',security:__contentlocker.security},success:function(response){var data={};if(!response||response.error||response.errors)return callback(data),void console.log('Unable to get the user data:'+request.responseText);if(data.source='twitter',data.social=!0,data.email=response.email,data.display_name=response.screen_name,response.name){var name=response.name.split(' ',2);2===name.length?(data.name=name[0],data.family=name[1]):data.name=response.name}else data.name=response.name;data.twitter_url='https://twitter.com/'+response.screen_name,data.image=function(){return response.profile_image_url?response.profile_image_url.replace('_normal',''):''}(),callback(data)},error:function(response){console.log('Unable to get the user data: '+response.responseText),callback({})}})},run_follow_action:function(lead,service_data,action,loader,callback){var self=this,data={};data.handler='twitter',data.request='follow',data.visitor_id=self._visitor_id,data.follow_to=self.options.follow.user,data.notification=self.options.follow.notification,data.context=self.locker.get_context_data(),data=cl.hooks.apply_filters(self.locker.id+'.ajax-data',data),data=cl.hooks.apply_filters(self.locker.id+'.twitter-follow.ajax-data',data),data.action='mts_cl_connect',data.security=__contentlocker.security;var request=$.ajax({url:__contentlocker.ajaxurl,type:'POST',dataType:'json',data:data,success:function(response){return(!response||response.error||response.errors)&&console.log('Unable to follow:'+request.responseText),response&&response.error?(self.locker.screen('default'),void self.show_notice('Unable to perform the follow action due to the error: '+response.error)):void callback()},error:function(){self.locker.screen('default'),self.show_notice('Unable to perform the follow action due to the unexpected error. See the logs for more details.'),console.log('Unable to follow: '+request.responseText)}})},run_tweet_action:function(lead,service_data,action,loader,callback){var self=this,data={};data.handler='twitter',data.request='tweet',data.visitor_id=self._visitor_id,data.tweet_message=self.options.tweet.message,data.context=self.locker.get_context_data(),data=cl.hooks.apply_filters(self.locker.id+'.ajax-data',data),data=cl.hooks.apply_filters(self.locker.id+'.twitter-tweet.ajax-data',data),data.action='mts_cl_connect',data.security=__contentlocker.security;var request=$.ajax({url:__contentlocker.ajaxurl,type:'POST',dataType:'json',data:data,success:function(response){return(!response||response.error||response.errors)&&console.log('Unable to tweet:'+request.responseText),response&&response.error?(self.locker.screen('default'),void self.show_notice('Unable to perform the tweet action due to the error: '+response.error)):void callback()},error:function(){self.locker.screen('default'),self.show_notice('Unable to perform the tweet action due to the unexpected error. See the logs for more details.'),console.log('Unable to tweet: '+request.responseText)}})}});cl.controls.twitter=TwitterSignin;var EmailSignin=ControlSigninBase.extend({sdk:'email',name:'email',defaults:{},init:function(){this.permissions=this.rest_permissions=['public_profile','email']},_render:function(){var self=this,long_title='<span class="mts-cl-long-title">'+self.process_button_title('long',cl.__.signin.email)+'</span>',short_title='<span class="mts-cl-short-title">'+self.process_button_title('short',cl.__.signin.email)+'</span>',button=$('<a href="#" class="mts-cl-control-button mts-cl-connect-button mts-cl-connect-email"><div class="mts-cl-control-button-wrapper"><div class="mts-cl-icon"><i class="fa fa-envelope"></i></div><div class="mts-cl-control-title-wrapper">'+long_title+short_title+'</div></div></a>');self.el.replaceWith(button),self.el=button,self.remove_loading_state()},connect:function(callback){var self=this,form=self.container.closest('.mts-cl-group').next().show();self.locker.container.addClass('mts-cl-showing-subscription-form'),form.on('submit',function(){return!!self._validate(form)&&(self.locker.container.removeClass('mts-cl-showing-subscription-form'),form.hide(),callback(self.get_values(form),{}),!1)})},get_values:function(form){var data={};return form.find('.mts-cl-input').each(function(){var input=$(this),val=input.val().trim(),id=input.attr('name').trim();val.length>0&&(data[id]=val)}),data},_validate:function(form){var result=!0;return form.find('.mts-cl-input').each(function(){var input=$(this),val=input.val().trim();input.hasClass('mts-cl-input-required')&&0===val.length&&(input.addClass('has-error'),result=!1)}),result}});cl.controls.email=EmailSignin,cl.hooks.add_action('locker-init',function(locker){if(cl.settings.get('google_analytics')&&('undefined'!=typeof window._gaq||'undefined'!=typeof window.ga)){var ping_google=function(category,action,label){window.ga?window.ga('send','event',category,action,label):window._gaq.push(['_trackEvent',category,action,label])};locker.add_action('unlock',function(type,name,url){url=url||window.location.href;var hash={'facebook-like':'Facebook Like','facebook-share':'Facebook Share','twitter-follow':'Twitter Follow','twitter-tweet':'Twitter Tweet','google-plus':'Google Plus','google-share':'Google Share','linkedin-share':'LinkedIn Share','youtube-subscribe':'Youtube Subscribe',facebook:'Facebook Sign-In',twitter:'Twitter Sign-In',google:'Google Sign-In',linkedin:'LinkedIn Sign-In',form:'Opt-In Form'};'button'===type?(ping_google('Lockers','Unlocked (Total)',url),ping_google('Lockers','Unlocked via '+hash[name],url)):'cross'===type&&(ping_google('Lockers','Skipped (Total)',url),ping_google('Lockers','Skipped via Cross',url))})}});var StateStorage=function(locker){this.locker=locker,this.always=locker.options.always,this.expires=locker.options.expires};_.extend(StateStorage.prototype,{is_unlocked:function(id){return!this.always&&!!this.get(id)},is_locked:function(id){return!this.is_unlocked(id)},can_lock:function(id){return!this.is_unlocked(id)},request_state:function(id){return this.is_unlocked(id)?'unlocked':'locked'},set_state:function(id,state){return!!this.always||('unlocked'===state?this.set(id):this.remove(id))},set:function(id){return!!id&&cl.helpers.store.set(id,!0,{expires:this.expires})},get:function(id){return!!id&&cl.helpers.store.get(id)},remove:function(id){return!!id&&cl.helpers.store.remove(id)}}),cl.StateStorage=StateStorage;var Locker=function(target,opts){this.el=target,this.options=opts,this.controls={},this.container=null,this.visitor_id=null,this.is_locked=!1};Locker.extend=cl.helpers.extend,_.extend(Locker.prototype,{init:function(){this.prepare_options(),this.prepare_group(),cl.hooks.do_action('locker-init',this),this.init_hooks(),this.init_screens(),this.can_lock()},prepare_options:function(){this.options=$.extend({},!0,this.defaults,this.options),this.visitor_id=cl.manager.get_visitor_id(),this.id=this.options.locker_id,this.options.overlap&&'blurring'===this.options.overlap.mode&&!cl.helpers.support_blurring()&&(this.options.overlap.mode=cl.settings.get('overlap_mode'))},prepare_group:function(){var group=this.options.group,self=this;_.each(group.buttons,function(button,name){if(_.has(cl.controls,name)){var control=new cl.controls[name](button,self);self.controls[name]=control}})},init_hooks:function(){var self=this;if(self.add_action('raw-impress',function(){self.do_action('impress')}),cl.settings.get('tracking')){self.add_action('unlock',function(sender,sender_name){-1!==$.inArray(sender,['button','cross'])&&('button'===sender?self.ping(sender_name,'unlock'):self.ping(sender,'skip'))});var hooks=['impress','error','got-youtube-subscriber'];$.each(hooks,function(index,value){self.add_action(value,function(){self.ping(value)})})}},can_lock:function(){var self=this,what='locked';return 0===_.size(this.options.group.buttons)?void self.unlock('group'):(_.each(self.controls,function(control){var id=self.get_identity()+'_'+control.get_identity(),state=self.get_state_storage().request_state(id);if('unlocked'===state)return what='unlocked',void self.unlock('provider')}),void('locked'===what&&self.lock()))},lock:function(){if(!this.is_locked){var self=this;self.render(),self.render_terms(),self.render_cross(),self.options.overlap?self.overlap_box.fadeIn(1e3,function(){'scroll'===self.options.overlap.position&&self.overlap_box.pin({containerSelector:self.el,padding:{top:35,bottom:35}})}):self.container.fadeIn(1e3),self.is_locked=!0,self.do_action('lock'),setTimeout(function(){self.track_visibility()},1500)}},unlock:function(type,name,control){if(type=type||'api',!this.is_locked)return this.show_content('button'===type),!1;if(this.show_content(!0),this.is_locked=!1,this.do_action('unlock',[type,name,control]),'undefined'!=typeof control){var id=this.get_identity()+'_'+control.get_identity();this.get_state_storage().set_state(id,'unlocked'),this.do_action('state-changed',['unlocked',type,name,control])}},render:function(){var self=this,content=self.el,container=$($('#tmpl-locker-'+self.options.locker_id).html()),_id='content-locker-'+self.options.locker_id;if(container.attr('id',_id),container.find('.mts-cl-wrapper-inner').wrapInner('<div class="mts-cl-screen mts-cl-screen-default"></div>'),self._screens.default=container.find('.mts-cl-screen-default'),self.options.overlap){content.show(),content.addClass('mts-cl-overlap-mode');var overlap_box=self.overlap_box=$('<div class="mts-cl-overlap-locker-box"></div>').hide();overlap_box.addClass('mts-cl-position-'+self.options.overlap.position),overlap_box.append(container);var overlap=$('<div class="mts-cl-overlap-box"></div>');if(overlap.addClass('mts-cl-'+self.options.overlap.mode+'-mode'),overlap.addClass(self.options.theme+'-theme'),overlap.append(overlap_box),overlap.append('<div class="mts-cl-overlap-background"></div>'),'blurring'===self.options.overlap.mode){content.wrapInner('<div class="mts-cl-blur-area"></div>'),self.blur_area=content.find('.mts-cl-blur-area');var vague=self.blur_area.Vague({intensity:self.options.overlap.intensity,forceSVGUrl:!1});vague.blur()}content.append(overlap)}else container.hide(),content.after(container);self.container=$('#'+_id),cl.settings.get('lazyload')?self.add_action('raw-impress',function(){self.create_controls()}):self.create_controls()},render_terms:function(){if(cl.settings.get('terms')||cl.settings.get('policy')){var self=this;self.container.addClass('mts-cl-has-terms'),self.container.find('.mts-cl-terms .mts-cl-link').click(function(){var link=$(this).attr('href');return window.open(link,'mts_cl_policies','width=550,height=400,resizable=yes,scrollbars=yes'),!1})}},render_cross:function(){if(this.options.close){var self=this;$('<div class="mts-cl-cross" title="'+cl.__.misc.close+'">&times;</div>').prependTo(self.container).on('click',function(){self.unlock('cross',!0)})}},track_visibility:function(){var self=this;self.container.appear(function(){self.do_action('raw-impress')},{accX:50,accY:100})},show_content:function(effect){var self=this;self.options.overlap?(console.log('overlap'),self.overlap_box&&self.overlap_box.hide(),self.blur_area&&self.blur_area.unblur()):self.container&&self.container.hide(),effect?self.el.fadeIn(1e3,function(){self.options.highlight&&(self.el.addClass('mts-cl-highlight'),setTimeout(function(){self.el.removeClass('mts-cl-highlight')},800))}):self.el.show()},get_context_data:function(){var data={locker_id:this.id,post_id:this.options.post_id,post_title:document.getElementsByTagName("title")[0].innerHTML,post_url:window.location.href};return data},ping:function(event_name,event_type){var self=this,request=$.ajax({url:__contentlocker.ajaxurl,type:'POST',dataType:'json',data:{action:'mts_cl_stats',security:__contentlocker.security,context:self.get_context_data(),stats:{name:event_name,type:event_type}}});request.success(function(data){if(data&&!data.success)return void console.log(data.message)}),request.error(function(data){if(data&&!data.success)return console.log('Unexpected error occurred during the ajax request:'),void console.log(request.responseText)})},get_state_storage:function(){return this._state_storage?this._state_storage:(this._state_storage=new cl.StateStorage(this),this._state_storage)},get_identity:function(){return this._identity?this._identity:(this._identity='locker_'+this.id,this._identity)},is_vertical:function(){return'vertical'===this.options.layout},has_counters:function(){return this.options.group.counters},add_action:function(action,callback,priority,seprate){cl.hooks.add_action(this.id+'.'+action,callback,priority),seprate&&cl.hooks.add_action(action,callback,priority)},do_action:function(action,args,seprate){args=args||[],args.push(this),cl.hooks.do_action.apply(void 0,$.merge([this.id+'.'+action],args)),seprate&&cl.hooks.do_action.apply(void 0,$.merge([action],args))},_screens:{},_screen_factory:{},screen:function(id,options){var self=this;if(!self._screen_factory[id]&&!self._screens[id])throw new Error('The screen with "'+id+'" not found in the locker.');if(self._current_screen=id,self.container.find('.mts-cl-screen').hide(),self._screens[id])return void self._screens[id].show();var screen=$('<div class="mts-cl-screen mts-cl-screen'+id+'"></div>').hide();self.container.find('.mts-cl-wrapper-inner').append(screen),self._screen_factory[id](screen,options),self._screens[id]=screen,screen.fadeIn(300)},_register_screen:function(id,func){this._screen_factory[id]=func},init_screens:function(){var self=this;self._current_screen='default',self._register_screen('loader',function(screen){screen.append($('<div class="mts-cl-processing-icon"></div>')),screen.append($('<div class="mts-cl-processing-text">'+cl.__.misc.data_processing+'</div>'))}),self._register_screen('enter-email',function(screen,options){var header=$('<div class="mts-cl-header"></div>');screen.append(header),options.title&&$('<div class="mts-cl-header-title">'+options.title+'</div>').appendTo(header),options.message&&$('<div class="mts-cl-header-message">'+options.message+'</div>').appendTo(header);var form=$('<div class="onp-sl-screen-form"></div>');screen.append(form);var email=$('<div class="mts-cl-field mts-cl-field-email"></div>'),input=$('<input />',{type:'text',name:'email',id:'mts-cl-input-email',placeholder:cl.__.misc.enter_your_email});email.append(input),form.append(email);var submit=$('<div class="mts-cl-field mts-cl-field-submit"></div>'),button=$('<button></button>',{class:'mts-cl-button mts-cl-form-button mts-cl-submit mts-cl-button-primary',text:options.button_title});submit.append(button),form.append(submit),options.note&&$('<div class="mts-cl-note mts-cl-nospam"></div>').html(options.note).appendTo(screen),screen.find('.mts-cl-submit').click(function(){var notice=function(msg){var notice=$('<div class="mts-cl-group-notice">'+msg+'</div>');notice.hide(),screen.find('.mts-cl-group-error').remove(),screen.append(notice),notice.fadeIn(500),setTimeout(function(){notice.fadeOut(500,function(){notice.remove()})},5e3)},email=$.trim(screen.find('#mts-cl-input-email').val());email&&email.length?cl.helpers.is_valid_email(email)&&options.callback?options.callback(email):notice(cl.__.errors.incorrect_email):notice(cl.__.errors.empty_email)})})}}),cl.Locker=Locker;var SocialLocker=Locker.extend({defaults:{lyout:'horizontal'},create_controls:function(){var self=this;_.each(self.controls,function(control,name){var placeholder=self.container.find('.mts-cl-'+name);control.render(placeholder)})}});cl.SocialLocker=SocialLocker;var SigninLocker=Locker.extend({defaults:{lyout:'horizontal'},create_controls:function(){var self=this;_.each(self.controls,function(control,name){var placeholder=self.container.find('.mts-cl-'+name);control.render(placeholder)})}});cl.SigninLocker=SigninLocker;var Manager={initialized:!1,init:function(){if(!this.initialized){var manager=this;cl.settings.get('managed_hook')?$(document).bind(cl.settings.get('managed_hook'),function(event,container,ignore_pageview){manager.create_lockers(container,ignore_pageview)}):manager.create_lockers(null,!0),manager.initialized=!0,$(document).trigger('cl-init')}},create_lockers:function(container,ignore_pageview){container=container||$(document);var inline=this.create_inline_lockers(container),css=this.create_css_lockers(container);!inline&&!css||this.initialized||(ignore_pageview||this.add_pageview(),this.add_lockerview()),_.each(inline,function(locker){locker.init()}),_.each(css,function(locker){locker.init()})},create_inline_lockers:function(container){container=container||$(document);var lockers=[];return container.find('.content-locker-call').each(function(){var el=$(this),locker_id=el.data('locker-id');if(!el.data('locker-init')){var data;_.has(__contentlocker.lockers,locker_id)?data=__contentlocker.lockers[locker_id]:(data=$.parseJSON(el.next().text()),el.next().remove()),el.data('locker-init',!0),el.removeClass('content-locker-call'),'social-locker'===data.type?lockers.push(new cl.SocialLocker(el,data)):'signin-locker'===data.type&&lockers.push(new cl.SigninLocker(el,data))}}),lockers},create_css_lockers:function(container){container=container||$(document);var lockers=[];return lockers},add_pageview:function(){},add_lockerview:function(){},get_visitor_id:function(){var visitor_id=cl.helpers.store.get('mts_cl_visitor_id');return visitor_id?visitor_id:(visitor_id=cl.helpers.guid(),cl.helpers.store.set('mts_cl_visitor_id',visitor_id,{expires:'365d'}),visitor_id)}};cl.manager=Manager,$(function(){cl.manager.init()});

})(jQuery);